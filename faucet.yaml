vlans:
  10:
    name: employees
    faucet_vips:
      - "10.0.10.1/24"
      - "2001:db8:10::1/64"
  20:
    name: guests
    faucet_vips:
      - "10.0.20.1/24"
      - "2001:db8:20::1/64"
  30:
    name: management
    faucet_vips:
      - "10.0.30.1/24"
      - "2001:db8:30::1/64"
  99:
    name: isp
    faucet_vips:
      - "203.0.113.14/28"
      - "2001:db8:40::14/64"

dps:
  s1:
    dp_id: 0x1
    interfaces:
      1:
        native_vlan: 10
      2:
        native_vlan: 20
        acl_in: guest_egress_policy
      3:
        native_vlan: 30
        acl_in: mgmt_port_security
      10:
        tagged_vlans: [10, 20, 30, 99]
      20:
        native_vlan: 99
        acl_in: isp_ingress_filter

  s2:
    dp_id: 0x2
    interfaces:
      1:
        native_vlan: 10
      2:
        native_vlan: 20
        acl_in: guest_egress_policy
      3:
        native_vlan: 30
        acl_in: mgmt_port_security
      10:
        tagged_vlans: [10, 20, 30, 99]
      20:
        native_vlan: 99
        acl_in: isp_ingress_filter

acls:

  guest_egress_policy:

    - rule:
      description: allow ARP
      eth_type: 0x0806
      actions:
        allow: 1

    # 1. Sta essentiÃ«le ICMPv6 ND door (anders werkt IPv6 in dit VLAN niet eens)
    - rule:
        description: allow icmpv6 nd (guest vlan)
        dl_type: 0x86DD
        ip_proto: 58            # ICMPv6
        icmpv6_type: 133-136    # RS, RA, NS, NA
        actions:
          allow: 1

    # 2. Blokkeer guest -> employees (IPv4)
    - rule:
        description: block guest -> employees (ipv4)
        dl_type: 0x0800
        ipv4_dst: 10.0.10.0/24
        actions:
          allow: 0

    # 3. Blokkeer guest -> management (IPv4)
    - rule:
        description: block guest -> management (ipv4)
        dl_type: 0x0800
        ipv4_dst: 10.0.30.0/24
        actions:
          allow: 0

    # 4. Blokkeer guest -> employees (IPv6)
    - rule:
        description: block guest -> employees (ipv6)
        dl_type: 0x86DD
        ipv6_dst: 2001:db8:10::/64
        actions:
          allow: 0

    # 5. Blokkeer guest -> management (IPv6)
    - rule:
        description: block guest -> management (ipv6)
        dl_type: 0x86DD
        ipv6_dst: 2001:db8:30::/64
        actions:
          allow: 0

    # 6. Sta verkeer naar ISP toe (IPv4)
    - rule:
        description: allow guest -> isp (ipv4)
        dl_type: 0x0800
        ipv4_dst: 203.0.113.0/28
        actions:
          allow: 1

    # 7. Sta verkeer naar ISP toe (IPv6)
    - rule:
        description: allow guest -> isp (ipv6)
        dl_type: 0x86DD
        ipv6_dst: 2001:db8:40::/64
        actions:
          allow: 1

    # 8. Drop alles wat niet hierboven matchte
    - rule:
        description: drop other guest traffic
        actions:
          allow: 0


  isp_ingress_filter:

    - rule:
      description: allow ARP
      eth_type: 0x0806
      actions:
        allow: 1

    # 1. Sta ICMPv6 ND toe zodat basis neighbour discovery niet stuk gaat
    - rule:
        description: allow icmpv6 nd (isp vlan)
        dl_type: 0x86DD
        ip_proto: 58
        icmpv6_type: 133-136
        actions:
          allow: 1

    # 2. Blokkeer ISP -> guest (IPv4)
    - rule:
        description: block isp -> guest (ipv4)
        dl_type: 0x0800
        ipv4_src: 203.0.113.0/28
        ipv4_dst: 10.0.20.0/24
        actions:
          allow: 0

    # 3. Blokkeer ISP -> guest (IPv6)
    - rule:
        description: block isp -> guest (ipv6)
        dl_type: 0x86DD
        ipv6_src: 2001:db8:40::/64
        ipv6_dst: 2001:db8:20::/64
        actions:
          allow: 0

    # 4. Drop verder ongewenst verkeer richting guest-subnetten die we eventueel vergeten hebben (defensief)
    - rule:
        description: block isp -> guest catchall
        dl_type: 0x0800
        ipv4_dst: 10.0.20.0/24
        actions:
          allow: 0

    - rule:
        description: block isp -> guest catchall v6
        dl_type: 0x86DD
        ipv6_dst: 2001:db8:20::/64
        actions:
          allow: 0

    # 5. drop de rest
    - rule:
        description: drop all other isp traffic
        actions:
          allow: 0


  mgmt_port_security:
   
    - rule:
      description: allow ARP
      eth_type: 0x0806
      actions:
        allow: 1

    - rule:
        description: allow known mgmt mac h3
        dl_src: "00:00:00:00:00:03"
        actions:
          allow: 1

    - rule:
        description: allow known mgmt mac h6
        dl_src: "00:00:00:00:00:13"
        actions:
          allow: 1

    - rule:
        description: drop other mgmt sources
        actions:
          allow: 0
