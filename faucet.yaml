Version: 4

vlans:
  10:
    name: employees
    faucet_vips:
      - "10.0.10.1/24"
      - "2001:db8:10::1/64"
  20:
    name: guests
    faucet_vips:
      - "10.0.20.1/24"
      - "2001:db8:20::1/64"
  30:
    name: management
    faucet_vips:
      - "10.0.30.1/24"
      - "2001:db8:30::1/64"
  99:
    name: isp
    faucet_vips:
      - "203.0.113.14/28"
      - "2001:db8:40::14/64"

dps:
  s1:
    interfaces:
      1:
        native_vlan: 10
      2:
        native_vlan: 20
        acl_in: guest_egress_policy
      3:
        native_vlan: 30
        acl_in: mgmt_port_security
      10:
        tagged_vlans: [10, 20, 30, 99]
      20:
        native_vlan: 99
        acl_in: isp_ingress_filter

  s2:
    interfaces:
      1:
        native_vlan: 10
      2:
        native_vlan: 20
        acl_in: guest_egress_policy
      3:
        native_vlan: 30
        acl_in: mgmt_port_security
      10:
        tagged_vlans: [10, 20, 30, 99]
      20:
        native_vlan: 99
        acl_in: isp_ingress_filter

acls:
  guest_egress_policy:
    - rule:
        description: Allow IPv4 to ISP
        dl_type: 0x0800
        ipv4_dst: 203.0.113.0/28
        actions:
          allow: 1
    - rule:
        description: Allow IPv6 to ISP
        dl_type: 0x86DD
        ipv6_dst: 2001:db8:40::/64
        actions:
          allow: 1
    - rule:
        description: Allow ICMPv6 ND (guest)
        dl_type: 0x86DD
        ip_proto: 58
        icmpv6_type: 133-136
        actions:
          allow: 1
    - rule:
        description: Block all other traffic
        actions:
          allow: 0

  isp_ingress_filter:
    - rule:
        description: Block IPv4 from ISP to Guest
        dl_type: 0x0800
        ipv4_dst: 10.0.20.0/24
        actions:
          allow: 0
    - rule:
        description: Block IPv6 from ISP to Guest
        dl_type: 0x86DD
        ipv6_dst: 2001:db8:20::/64
        actions:
          allow: 0
    - rule:
        description: Allow ICMPv6 ND (ISP)
        dl_type: 0x86DD
        ip_proto: 58
        icmpv6_type: 133-136
        actions:
          allow: 1
    - rule:
        description: Allow all other traffic
        actions:
          allow: 1

  mgmt_port_security:
    - rule:
        description: Allow management traffic from known VLANs (IPv4)
        dl_type: 0x0800
        ipv4_src: [10.0.10.0/24, 10.0.20.0/24, 203.0.113.0/28]
        actions:
          allow: 1
    - rule:
        description: Allow management traffic from known VLANs (IPv6)
        dl_type: 0x86DD
        ipv6_src: [2001:db8:10::/64, 2001:db8:20::/64, 2001:db8:40::/64]
        actions:
          allow: 1
    - rule:
        description: Allow ICMPv6 ND (Mgmt)
        dl_type: 0x86DD
        ip_proto: 58
        icmpv6_type: 133-136
        actions:
          allow: 1
    - rule:
        description: Block all other traffic
        actions:
          allow: 0